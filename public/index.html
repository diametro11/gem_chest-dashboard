<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>GEM Chest Punkte</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    th { background-color: #eee; }
  </style>
</head>
<body>
  <h1>GEM Chest Punkte</h1>
  <table id="pointsTable">
    <thead>
      <tr>
        <th>User ID</th>
        <th>Punkte</th>
      </tr>
    </thead>
    <tbody>
      <!-- Daten werden hier automatisch eingefÃ¼gt -->
    </tbody>
  </table>

  <script>
    // Punktesystem (Type + Level)
    const pointsSystem = {
      "Common": {
        "5": 5,
        "10": 10,
        "15": 15,
        "20": 20,
        "25": 25
      },
      "Rare": {
        "10": 20,
        "15": 25,
        "20": 30,
        "25": 35,
        "30": 40
      },
      "Epic": {
        "15": 30,
        "20": 35,
        "25": 40,
        "30": 45,
        "35": 50
      },
      "Arena": {
        "Any": 5
      },
      "Citadel": {
        "Any": 30
      }
    };

    async function loadData() {
      const res = await fetch('/data');
      const data = await res.json();
      const tbody = document.querySelector('#pointsTable tbody');
      tbody.innerHTML = '';

      // Beispielhafte Datenstruktur von data.json
      // {
      //   "Tebur": [
      //     { "type": "Common", "level": "20" },
      //     { "type": "Rare", "level": "25" }
      //   ],
      //   "Nirius": [
      //     { "type": "Epic", "level": "30" }
      //   ]
      // }

      for (const userId in data) {
        const chests = data[userId];
        let totalPoints = 0;

        for (const chest of chests) {
          const typePoints = pointsSystem[chest.type];
          if (typePoints) {
            const levelKey = chest.level.toString();
            if (typePoints[levelKey] !== undefined) {
              totalPoints += typePoints[levelKey];
            } else if (typePoints["Any"] !== undefined) {
              totalPoints += typePoints["Any"];
            }
          }
        }

        const row = document.createElement('tr');
        const nameCell = document.createElement('td');
        const pointsCell = document.createElement('td');

        nameCell.textContent = userId;
        pointsCell.textContent = totalPoints;

        row.appendChild(nameCell);
        row.appendChild(pointsCell);
        tbody.appendChild(row);
      }
    }

    loadData();
  </script>
</body>
</html>
